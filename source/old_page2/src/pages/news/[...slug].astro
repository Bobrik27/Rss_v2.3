---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const news = await getCollection('news');
  return news.map(item => ({
    params: { slug: item.slug },
    props: { item },
  }));
}

const { item } = Astro.props;
const { Content } = await item.render();
---

<Layout title={item.data.title}>
  <article class="pt-32 pb-24 px-6 min-h-screen">
    
    <!-- Центральная колонка -->
    <div class="max-w-3xl mx-auto">

      <!-- 1. Навигация и Теги -->
      <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
        <a href="/news" class="inline-flex items-center gap-2 text-brand-muted hover:text-white transition group no-underline">
          <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center border border-white/10 group-hover:border-white/30">
             <svg class="w-4 h-4 group-hover:-translate-x-0.5 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          </div>
          <span class="text-sm font-medium">Назад</span>
        </a>

        <div class="flex gap-2">
           {item.data.tags?.map((tag: string) => (
            <span class="text-[10px] font-bold text-blue-400 bg-blue-500/10 px-2 py-1 rounded border border-blue-500/20 uppercase tracking-wider">
              {tag}
            </span>
          ))}
        </div>
      </div>

      <!-- 2. Заголовок -->
      <h1 class="text-3xl md:text-5xl font-bold mb-6 leading-tight text-white">
        {item.data.title}
      </h1>

      <!-- 3. Мета-данные -->
      <div class="flex items-center gap-4 text-brand-muted text-sm border-l-2 border-brand-accent pl-4 mb-10">
        <time datetime={item.data.pubDate.toISOString()}>
           {item.data.pubDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' })}
        </time>
        
        {item.data.source && (
          <>
            <span class="w-1 h-1 rounded-full bg-brand-muted"></span>
            <span class="text-blue-300">
              {item.data.source}
            </span>
          </>
        )}
      </div>

      <!-- 4. Картинка (Только если она существует) -->
      {item.data.image && (
        <div class="mb-12 rounded-xl overflow-hidden border border-white/10 shadow-2xl bg-brand-surface">
          <img 
            src={item.data.image} 
            alt={item.data.title} 
            class="w-full h-auto object-cover"
            onerror="this.style.display='none'" 
          />
        </div>
      )}

      <!-- 5. Текст -->
      <div class="news-body">
        <Content />
      </div>

      <!-- 6. Кнопка (Исправленная) -->
      <div class="mt-16 pt-10 border-t border-white/10 flex justify-center">
         <a href="https://t.me/tvoj_bot" target="_blank" class="inline-flex items-center gap-3 bg-brand-surface border border-white/10 px-8 py-4 rounded-xl hover:bg-white/5 hover:border-brand-accent/50 transition group no-underline w-auto">
            <span class="text-white font-medium whitespace-nowrap">Обсудить в Telegram</span>
            <svg class="w-5 h-5 text-brand-accent group-hover:translate-x-1 transition flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
         </a>
      </div>

    </div>
  </article>
</Layout>

<style>
  .news-body {
    font-size: 1.125rem;
    line-height: 1.8;
    color: #e2e8f0;
  }
  .news-body :global(p) { margin-bottom: 1.5rem; }
  .news-body :global(h2) { font-size: 1.5rem; font-weight: 700; color: white; margin-top: 2.5rem; margin-bottom: 1rem; }
  .news-body :global(ul) { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; color: #cbd5e1; }
  .news-body :global(a) { color: #60a5fa; text-decoration: underline; text-underline-offset: 4px; }
  .news-body :global(blockquote) { border-left: 4px solid #3b82f6; padding-left: 1.5rem; margin: 2rem 0; font-style: italic; color: #94a3b8; }
</style>